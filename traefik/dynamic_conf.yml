http:
  routers:
    # ========================================================================
    # TRAEFIK DASHBOARD
    # ========================================================================
    dashboard:
      rule: Host(`traefik.wizardsofts.com`) || Host(`traefik.localhost`) || Host(`10.0.0.84`)
      service: api@internal
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt
      middlewares:
        - dashboard-auth

    # ========================================================================
    # WEB APPLICATIONS - Domain-based routing
    # ========================================================================

    # Wizardsofts.com - Corporate Website
    wizardsofts-web:
      rule: Host(`www.wizardsofts.com`)
      service: wizardsofts-web
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt
      middlewares:
        - rate-limit

    # Daily Deen Guide - Independent Website
    dailydeen-web:
      rule: Host(`dailydeenguide.com`) || Host(`www.dailydeenguide.com`)
      service: dailydeen-web
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt
      middlewares:
        - rate-limit

    # Guardian Investment BD / Quant-Flow
    quant-web:
      rule: Host(`www.guardianinvestmentbd.com`) || Host(`guardianinvestmentbd.com`)
      service: quant-web
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt
      middlewares:
        - rate-limit

    # ========================================================================
    # IP-BASED ROUTING (for testing before DNS)
    # ========================================================================

    # Wizardsofts via IP
    wizardsofts-web-ip:
      rule: Host(`10.0.0.84`) && PathPrefix(`/wizardsofts`)
      service: wizardsofts-web
      entryPoints:
        - web
        - websecure
      middlewares:
        - strip-wizardsofts-prefix

    # Daily Deen via IP
    dailydeen-web-ip:
      rule: Host(`10.0.0.84`) && PathPrefix(`/dailydeen`)
      service: dailydeen-web
      entryPoints:
        - web
        - websecure
      middlewares:
        - strip-dailydeen-prefix

    # Quant-Flow via IP
    quant-web-ip:
      rule: Host(`10.0.0.84`) && PathPrefix(`/quant`)
      service: quant-web
      entryPoints:
        - web
        - websecure
      middlewares:
        - strip-quant-prefix

    # ========================================================================
    # INFRASTRUCTURE SERVICES
    # ========================================================================

    # API Gateway
    api-gateway:
      rule: Host(`api.wizardsofts.com`)
      service: api-gateway
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt
      middlewares:
        - rate-limit

    # Eureka Service Discovery
    eureka:
      rule: Host(`eureka.wizardsofts.com`)
      service: eureka
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt
      middlewares:
        - admin-auth

    # ========================================================================
    # MAILCOW EMAIL SERVER
    # ========================================================================

    # Mailcow ACME Challenge (HTTP)
    mailcow-acme:
      rule: PathPrefix(`/.well-known/acme-challenge/`)
      service: mailcow-http
      entryPoints:
        - web
      priority: 1000

  # ==========================================================================
  # MIDDLEWARES
  # ==========================================================================

  middlewares:
    # Basic Authentication for Admin Interfaces
    admin-auth:
      basicAuth:
        users:
          - "admin:$apr1$hGZ8qHVz$xMvCb3QLm3ZnFnJlpZFT5."

    # Basic Authentication for Traefik Dashboard
    dashboard-auth:
      basicAuth:
        users:
          - "admin:$apr1$2I40dvBH$UxIJnwsA1a5PAJjGzV2Fd1"

    # Rate Limiting (100 req/s average, 50 burst)
    rate-limit:
      rateLimit:
        average: 100
        burst: 50

    # Path prefix stripping for IP-based access
    strip-wizardsofts-prefix:
      stripPrefix:
        prefixes:
          - "/wizardsofts"

    strip-dailydeen-prefix:
      stripPrefix:
        prefixes:
          - "/dailydeen"

    strip-quant-prefix:
      stripPrefix:
        prefixes:
          - "/quant"

  # ==========================================================================
  # SERVICES
  # ==========================================================================

  services:
    # Web Applications
    wizardsofts-web:
      loadBalancer:
        servers:
          - url: "http://ws-wizardsofts-web:3000"

    dailydeen-web:
      loadBalancer:
        servers:
          - url: "http://ws-daily-deen-web:3000"

    quant-web:
      loadBalancer:
        servers:
          - url: "http://gibd-quant-web:3000"

    # Infrastructure Services
    api-gateway:
      loadBalancer:
        servers:
          - url: "http://ws-gateway:8080"

    eureka:
      loadBalancer:
        servers:
          - url: "http://ws-discovery:8761"

    # Mailcow
    mailcow-http:
      loadBalancer:
        servers:
          - url: "http://nginx-mailcow:80"

# ============================================================================
# TCP ROUTERS (for TLS passthrough)
# ============================================================================

tcp:
  routers:
    # Mailcow UI (HTTPS with TLS passthrough)
    mailcow-ui:
      rule: HostSNI(`mail.wizardsofts.com`) || HostSNI(`mail.dailydeenguide.com`)
      service: mailcow-https
      entryPoints:
        - websecure
      tls:
        passthrough: true

  services:
    mailcow-https:
      loadBalancer:
        servers:
          - address: "nginx-mailcow:443"
