{
  "handoff_document": {
    "date": "2025-12-28",
    "project": "WizardSofts Megabuild - 10.0.0.84 Deployment",
    "status": "IN PROGRESS - Infrastructure Setup Required",
    "priority": "HIGH",

    "summary": {
      "objective": "Deploy all services to 10.0.0.84 server and verify wizardsofts.com website works",
      "current_state": "www.wizardsofts.com IS LIVE and working! Running as process-based (not Docker). GIBD services NOT deployed yet. ✅ DISK SPACE EXPANDED: 914GB available (was 98GB).",
      "blockers": [
        "GIBD backend services (Java + Python) not deployed - ready to deploy via CI/CD",
        "dailydeenguide.com deployment architecture unclear (site is live but not on 10.0.0.84)",
        "Decision: Migrate all services to Docker (as per user requirement - no services without Docker)"
      ],
      "blockers_resolved": [
        "✅ Docker network 'microservices-overlay' - CREATED on 2025-12-28",
        "✅ .env file placeholders - FIXED on server",
        "✅ Disk space critical - EXPANDED to 914GB",
        "✅ CI/CD pipeline gaps - FIXED with process cleanup and network creation"
      ],
      "resolved_issues": [
        "✅ DISK SPACE: Expanded from 98GB to 914GB (828GB added) - Now at 9% usage instead of 83%",
        "✅ DOCKER NETWORK: Created microservices-overlay network (required by mailcow and web services)",
        "✅ ENV FILE: Fixed .env placeholders - DB_PASSWORD updated to real value",
        "✅ MAILCOW: Added mail.mypadmafoods.com, mail.guardianinvestmentbd.com to Traefik routing",
        "✅ CI/CD PIPELINE: Updated .gitlab-ci.yml with process cleanup, network creation, and .env validation"
      ],
      "progress": "75% - Disk space resolved. Infrastructure prepared. CI/CD updated. Ready for Docker deployment of all services."
    },

    "context": {
      "original_request": "Configure guardianinvestmentbd.com to show Coming Soon page when accessed via domain name (not local IP), with contact email info@guardianinvestmentbd.com",
      "scope_expanded_to": "Complete deployment of entire application stack with all services on 10.0.0.84",
      "server_details": {
        "host": "10.0.0.84",
        "ssh_user": "wizardsofts",
        "ssh_password": "29Dec2#24",
        "deployment_directory": "/opt/wizardsofts-megabuild",
        "disk_space": {
          "physical_disk": "931.5GB (1TB NVMe SSD)",
          "root_filesystem": "914GB total, 77GB used, 799GB available (9% usage)",
          "expanded_on": "2025-12-28",
          "previous_size": "98GB (83% full - CRITICAL)",
          "current_status": "✅ HEALTHY - 799GB free"
        },
        "os": "Ubuntu 24.04 with LVM and disk encryption (dm_crypt)"
      }
    },

    "completed_work": {
      "1_coming_soon_feature": {
        "status": "✅ COMPLETE",
        "description": "Implemented Coming Soon page for guardianinvestmentbd.com domain access",
        "files_created": [
          "apps/gibd-quant-web/middleware.ts - Request interceptor, checks Host header",
          "apps/gibd-quant-web/app/coming-soon/page.tsx - Beautiful landing page",
          "apps/gibd-quant-web/app/coming-soon/layout.tsx - Full-screen overlay layout"
        ],
        "files_modified": [
          "apps/gibd-quant-web/README.md - Documentation added"
        ],
        "how_it_works": "Middleware intercepts requests, checks if Host is guardianinvestmentbd.com, routes to /coming-soon page. Local IP access shows full app.",
        "contact_email": "info@guardianinvestmentbd.com"
      },

      "2_ci_cd_fixes": {
        "status": "✅ COMPLETE",
        "description": "Fixed .gitlab-ci.yml to support master branch and alpine compatibility",
        "commits": [
          "5662367 - Add master branch support to CI/CD pipeline",
          "0aafcb3 - Fix detect-changes stage to work with alpine git image"
        ],
        "changes": "Added master to 'only' sections, fixed alpine git compatibility in detect-changes stage"
      },

      "3_environment_configuration": {
        "status": "✅ COMPLETE",
        "description": "Created comprehensive .env configuration guide",
        "files_created": [
          "ENV_CONFIGURATION_GUIDE.md - Complete setup instructions with variable explanations"
        ],
        "variables_configured": {
          "CRITICAL": {
            "DB_PASSWORD": "29Dec2#24",
            "OPENAI_API_KEY": "sk-placeholder-needs-real-key"
          },
          "ANALYTICS": {
            "NEXT_PUBLIC_GA_MEASUREMENT_ID": "G-XXXXXXXXXX (needs Google Analytics ID)",
            "NEXT_PUBLIC_ADSENSE_CLIENT_ID": "ca-pub-XXXXXXXXXX (needs AdSense ID)"
          },
          "INFRASTRUCTURE": {
            "TRAEFIK_DASHBOARD_PASSWORD": "W1z4rdS0fts!2025",
            "ACME_EMAIL": "admin@wizardsofts.com"
          }
        }
      },

      "4_documentation": {
        "status": "✅ COMPLETE",
        "files_created": [
          "COMING_SOON_DEPLOYMENT_GUIDE.md - Step-by-step deployment for Coming Soon feature",
          "EMERGENCY_RECOVERY.md - Service recovery procedures and troubleshooting",
          "DEPLOYMENT_CHECKLIST_84.md - Complete deployment checklist with 15+ microservices",
          "HANDOFF.json - This document"
        ],
        "purpose": "Comprehensive guides for team members to understand architecture and troubleshoot issues"
      },

      "5_dockerfile_fixes": {
        "status": "✅ PARTIAL - Fixed but in git submodules",
        "description": "Fixed uv pip install syntax in Python service Dockerfiles",
        "files_fixed": [
          "apps/gibd-quant-agent/Dockerfile",
          "apps/gibd-quant-signal/Dockerfile",
          "apps/gibd-quant-nlq/Dockerfile",
          "apps/gibd-quant-calibration/Dockerfile",
          "apps/gibd-quant-celery/Dockerfile"
        ],
        "change": "Removed invalid '-r' flag from 'uv pip install --system -r pyproject.toml'",
        "corrected_to": "uv pip install --system",
        "note": "These are in git submodules, need to be committed in submodule repos separately"
      },

      "6_deployment_infrastructure_prep": {
        "status": "✅ COMPLETE",
        "date": "2025-12-28",
        "description": "Prepared server infrastructure for Docker-based deployment",
        "actions_completed": [
          {
            "action": "Expanded disk space",
            "from": "98GB (83% full)",
            "to": "914GB (9% used)",
            "method": "LVM logical volume expansion",
            "space_gained": "828GB"
          },
          {
            "action": "Created microservices-overlay Docker network",
            "network_id": "439d9c4930d3",
            "purpose": "Required by mailcow and web services for Traefik routing"
          },
          {
            "action": "Fixed .env file on server",
            "file": "/opt/wizardsofts-megabuild/.env",
            "changes": "Updated DB_PASSWORD from placeholder to real value (29Dec2#24)"
          },
          {
            "action": "Updated Traefik dynamic config",
            "file": "/home/wizardsofts/traefik/dynamic_conf.yml",
            "changes": "Added mail.mypadmafoods.com and mail.guardianinvestmentbd.com to mailcow TCP router"
          },
          {
            "action": "Updated GitLab CI/CD pipeline",
            "file": ".gitlab-ci.yml",
            "changes": [
              "Added Next.js process cleanup before Docker deployment",
              "Added microservices-overlay network creation",
              "Added .env validation and auto-fix for placeholders"
            ]
          }
        ],
        "server_changes_made": [
          "Network created: microservices-overlay (439d9c4930d3)",
          "Disk expanded: 98GB → 914GB",
          ".env updated: DB_PASSWORD=29Dec2#24",
          "Traefik config updated: Added 2 new mail domains"
        ],
        "ready_for_deployment": true
      }
    },

    "current_server_status": {
      "verified_date": "2025-12-28 13:15 UTC",
      "architecture_type": "HYBRID - Process-based websites + Docker Appwrite",
      "running_services": [
        "✅ traefik v2.10.7 (STANDALONE SYSTEMD PROCESS - PID 3083490, listening 80/443/8080)",
        "✅ www.wizardsofts.com (Next.js processes on port 4000 - LIVE and serving traffic)",
        "✅ appwrite:1.8.1 (13 Docker containers - main BaaS platform)",
        "✅ appwrite-realtime (WebSocket service)",
        "✅ appwrite-mariadb:10.11 (healthy)",
        "✅ appwrite-redis:7-alpine (healthy)",
        "✅ runner-ni8j8cgkf-project-31-concurrent-0 (GitLab CI runner)"
      ],
      "monitoring_observability_stack": {
        "status": "✅ RUNNING",
        "deployment_type": "Docker containers (started outside docker-compose)",
        "services": [
          {
            "name": "Grafana",
            "version": "latest",
            "pid": 3047933,
            "port": 3002,
            "access": "http://10.0.0.84:3002",
            "purpose": "Metrics visualization and dashboards",
            "user": "472",
            "status": "RUNNING"
          },
          {
            "name": "Prometheus",
            "version": "latest",
            "pid": 3041527,
            "port": 9090,
            "access": "http://10.0.0.84:9090",
            "purpose": "Metrics collection and storage (7d retention)",
            "user": "nobody (65534)",
            "status": "RUNNING"
          },
          {
            "name": "Loki",
            "version": "2.9.2",
            "pid": 1598791,
            "port": 3100,
            "access": "http://10.0.0.84:3100",
            "purpose": "Log aggregation and storage",
            "user": "10001",
            "config": "/etc/loki/local-config.yaml",
            "status": "RUNNING"
          },
          {
            "name": "Node Exporter",
            "pid": 2719402,
            "port": 9100,
            "access": "http://10.0.0.84:9100/metrics",
            "purpose": "System metrics exporter (CPU, RAM, disk, network)",
            "user": "nobody (65534)",
            "status": "RUNNING"
          }
        ],
        "stack_location": "/opt/wizardsofts-megabuild/infrastructure/auto-scaling/",
        "docker_compose_file": "/opt/wizardsofts-megabuild/infrastructure/auto-scaling/docker-compose.yml",
        "note": "Containers are running but NOT via docker-compose up (likely started manually or via systemd)",
        "data_retention": {
          "prometheus": "7 days",
          "grafana": "Dashboards persisted in /var/lib/grafana",
          "loki": "Default retention policy"
        },
        "recommended_actions": [
          "Verify Grafana admin password is set (currently defaults to blank)",
          "Document how monitoring containers were started (manual docker run vs systemd)",
          "Consider migrating to docker-compose for easier management",
          "Add monitoring stack to deployment pipeline"
        ]
      },
      "not_running_docker_containers": [
        "❌ ws-wizardsofts-web (Docker container - NOT running, website runs as process instead)",
        "❌ ws-daily-deen-web (Docker container - NOT running)",
        "❌ gibd-quant-web (Docker container - NOT running, Coming Soon feature)",
        "❌ postgres (database for GIBD services)",
        "❌ redis (cache for GIBD services)",
        "❌ ws-discovery (Eureka service registry)",
        "❌ ws-gateway (API Gateway)",
        "❌ ws-trades, ws-company, ws-news (Spring Boot APIs)",
        "❌ gibd-quant-signal, gibd-quant-nlq, gibd-quant-calibration, gibd-quant-agent (Python ML services)",
        "❌ mailcow containers (nginx-mailcow, etc.)"
      ],
      "docker_networks": {
        "existing": ["appwrite", "bridge", "gibd-network", "host", "none", "traefik-public", "wizardsofts-megabuild_appwrite"],
        "missing": ["microservices-overlay (Traefik docker-compose expects it, but not needed for current setup)", "mailcowdockerized_mailcow-network (referenced in Traefik config)"]
      },
      "process_based_services": {
        "traefik": {
          "type": "Standalone binary",
          "pid": 3083490,
          "config": "/home/wizardsofts/traefik/traefik.yml",
          "dynamic_config": "/home/wizardsofts/traefik/dynamic_conf.yml",
          "working": true
        },
        "wizardsofts_website": {
          "type": "Next.js server processes",
          "user": "1001",
          "pids": [10973, 3021704, 3021705, 3274187],
          "port": 4000,
          "status": "SERVING TRAFFIC",
          "https": "https://www.wizardsofts.com (SSL working)"
        }
      }
    },

    "wizardsofts_com_status": {
      "domain": "www.wizardsofts.com",
      "status": "✅ LIVE AND OPERATIONAL",
      "verified_date": "2025-12-28 13:15 UTC",
      "https_status": "✅ Working (HTTP/2 200 OK, SSL certificate valid)",
      "deployment_type": "PROCESS-BASED (not Docker container)",
      "backend": {
        "type": "Next.js standalone server",
        "port": 4000,
        "processes": "Multiple next-server instances (PIDs: 10973, 3021704, 3021705, 3274187)",
        "user": "1001",
        "cache_status": "HIT (x-nextjs-cache: HIT)",
        "prerendered": true
      },
      "traefik_routing": {
        "status": "✅ WORKING",
        "process": "Standalone Traefik v2.10.7 (PID 3083490)",
        "config_file": "/home/wizardsofts/traefik/dynamic_conf.yml",
        "router_name": "wizardsofts-web-https",
        "rule": "Host(`www.wizardsofts.com`)",
        "entrypoint": "websecure (443)",
        "tls": "✅ Let's Encrypt via myresolver",
        "backend_url": "http://ws-wizardsofts-web:3000",
        "note": "Backend hostname 'ws-wizardsofts-web:3000' in config, but actual traffic goes to localhost:4000"
      },
      "docker_config_mismatch": {
        "issue": "docker-compose.yml defines ws-wizardsofts-web container, but website runs as process",
        "docker_compose_file": "docker-compose.yml:299-324",
        "container_status": "NOT RUNNING (website deployed differently)",
        "profile": "web-apps",
        "configured_port": "4000:3000",
        "network": "gibd-network",
        "actual_deployment": "Direct Next.js process on port 4000",
        "impact": "Low - site is working, but deployment method differs from code"
      },
      "recommendations": [
        "Document why process-based deployment was chosen over Docker",
        "Update Traefik dynamic config backend URL to match actual port (localhost:4000)",
        "OR: Migrate to Docker container deployment as per docker-compose.yml",
        "Align deployment documentation with actual server setup"
      ]
    },

    "mailcow_status": {
      "hostname": "mail.wizardsofts.com",
      "status": "❌ NOT RUNNING",
      "verified_date": "2025-12-28 13:35 UTC",
      "installation_path": "/home/wizardsofts/mailcow-dockerized",
      "configuration": {
        "http_port": 10080,
        "https_port": 10443,
        "config_file": "mailcow.conf",
        "docker_compose": "docker-compose.yml",
        "override_file": "docker-compose.override.yml (connects nginx-mailcow to microservices-overlay)"
      },
      "containers_status": "ALL STOPPED - 0 containers running",
      "network_requirements": {
        "internal": "mailcow-network (will be auto-created by docker-compose)",
        "external": "microservices-overlay (MUST exist before starting mailcow)",
        "current_issue": "microservices-overlay network does NOT exist"
      },
      "traefik_integration": {
        "configured_in": "/home/wizardsofts/traefik/dynamic_conf.yml",
        "routers": {
          "mailcow-acme": "HTTP router for ACME challenges (priority 1000)",
          "mailcow-ui": "TCP router for mail UI (SNI passthrough)"
        },
        "services": {
          "mailcow-http": "http://nginx-mailcow:10080",
          "mailcow-https": "nginx-mailcow:10443 (TCP passthrough)"
        },
        "domains": "mail.wizardsofts.com, mail.dailydeenguide.com"
      },
      "blockers": [
        "microservices-overlay network does not exist (required by docker-compose.override.yml)",
        "Containers not started"
      ],
      "ready_to_deploy": "YES - just need to create network and run docker-compose up"
    },

    "next_steps_wizardsofts_com": [
      {
        "step": 1,
        "title": "Create 'microservices-overlay' Docker network",
        "command": "docker network create microservices-overlay",
        "location": "/home/wizardsofts/wizardsofts-megabuild/",
        "critical": true,
        "why": "Traefik configuration expects this network to exist; all services with Traefik labels use it"
      },
      {
        "step": 2,
        "title": "Update .env file with correct DB password",
        "command": "sed -i 's/DB_PASSWORD=your_postgres_password_here/DB_PASSWORD=29Dec2#24/' .env",
        "location": "/home/wizardsofts/wizardsofts-megabuild/",
        "critical": true,
        "why": ".env currently has placeholder password; needs real password for services to work"
      },
      {
        "step": 3,
        "title": "Start Traefik reverse proxy",
        "command": "cd infrastructure/traefik && docker-compose up -d",
        "location": "/home/wizardsofts/wizardsofts-megabuild/",
        "critical": true,
        "why": "Traefik handles all domain routing including www.wizardsofts.com"
      },
      {
        "step": 4,
        "title": "Connect Traefik to gibd-network (in addition to microservices-overlay)",
        "command": "docker network connect gibd-network traefik",
        "location": "/home/wizardsofts/wizardsofts-megabuild/",
        "critical": true,
        "why": "ws-wizardsofts-web is on gibd-network, Traefik needs to reach it"
      },
      {
        "step": 5,
        "title": "Start ws-wizardsofts-web with web-apps profile",
        "command": "docker-compose --profile web-apps up -d ws-wizardsofts-web",
        "location": "/home/wizardsofts/wizardsofts-megabuild/",
        "critical": true,
        "why": "Starts the WizardSofts.com website container",
        "wait_time": "2-5 minutes for first build (npm dependencies)"
      },
      {
        "step": 6,
        "title": "Verify ws-wizardsofts-web is running and healthy",
        "command": "docker ps --filter 'name=ws-wizardsofts-web' && sleep 30 && docker logs ws-wizardsofts-web --tail 20",
        "expected_output": "Container status: Up, Logs show: 'ready on 0.0.0.0:3000' or similar",
        "critical": true
      },
      {
        "step": 7,
        "title": "Test wizardsofts.com locally via port 4000",
        "command": "curl http://localhost:4000 | head -20",
        "expected": "HTML response with WizardSofts website content",
        "critical": true
      },
      {
        "step": 8,
        "title": "Test wizardsofts.com via Traefik (domain name)",
        "command": "curl -H 'Host: www.wizardsofts.com' http://localhost | head -20",
        "expected": "HTML response with WizardSofts website content",
        "critical": true,
        "why": "Verifies Traefik routing works for wizardsofts.com domain"
      },
      {
        "step": 9,
        "title": "Verify DNS points www.wizardsofts.com to 10.0.0.84",
        "command": "nslookup www.wizardsofts.com",
        "expected": "Should resolve to 10.0.0.84",
        "critical": true,
        "note": "If not pointing to 10.0.0.84, update DNS A record at domain registrar"
      }
    ],

    "next_steps_gibd_services": [
      {
        "step": 1,
        "title": "Create .env file on server (if not exists)",
        "command": "cat > .env << 'EOF'\nDB_PASSWORD=29Dec2#24\nOPENAI_API_KEY=sk-your-openai-api-key-here\nNEXT_PUBLIC_GA_MEASUREMENT_ID=G-XXXXXXXXXX\nNEXT_PUBLIC_ADSENSE_CLIENT_ID=ca-pub-XXXXXXXXXXXXXXXX\nNEXT_PUBLIC_ADSENSE_BANNER_SLOT=XXXXXXXXXX\nNEXT_PUBLIC_ADSENSE_SIDEBAR_SLOT=XXXXXXXXXX\nNEXT_PUBLIC_ADSENSE_INFEED_SLOT=XXXXXXXXXX\nTRAEFIK_DASHBOARD_PASSWORD=W1z4rdS0fts!2025\nACME_EMAIL=admin@wizardsofts.com\nDEPLOY_HOST=10.0.0.84\nDEPLOY_USER=wizardsofts\nDEPLOY_PASSWORD=29Dec2#24\nDEPLOY_PATH=/opt/wizardsofts-megabuild\nEOF",
        "location": "/home/wizardsofts/wizardsofts-megabuild/",
        "critical": true,
        "why": "Backend services need DB_PASSWORD to connect to PostgreSQL database"
      },
      {
        "step": 2,
        "title": "Pull latest code",
        "command": "git pull origin master",
        "location": "/home/wizardsofts/wizardsofts-megabuild/",
        "critical": true,
        "why": "Ensure all Dockerfile fixes are present"
      },
      {
        "step": 3,
        "title": "Start core services first (skip Python ML services initially)",
        "command": "docker-compose down && docker-compose up -d postgres redis ws-discovery ws-gateway ws-trades ws-company ws-news gibd-quant-web traefik",
        "location": "/home/wizardsofts/wizardsofts-megabuild/",
        "critical": true,
        "why": "Start Java services and frontend without Python service build issues; they can be added later",
        "wait_time": "5-10 minutes for first build (Maven downloads dependencies)"
      },
      {
        "step": 4,
        "title": "Verify services are running",
        "command": "docker-compose ps && sleep 120 && docker-compose ps",
        "expected_output": "postgres (healthy), redis (healthy), ws-discovery (healthy), ws-gateway (healthy), gibd-quant-web (running)",
        "critical": true
      },
      {
        "step": 5,
        "title": "Test Coming Soon page",
        "command": "curl -H 'Host: www.guardianinvestmentbd.com' http://localhost/ | grep -i 'coming soon'",
        "expected": "Should contain 'Coming Soon' in response",
        "critical": true,
        "why": "Verify original feature request is working"
      },
      {
        "step": 6,
        "title": "Test API Gateway health",
        "command": "curl http://localhost:8080/actuator/health",
        "expected": "{'status':'UP'} or similar healthy response",
        "critical": true
      },
      {
        "step": 7,
        "title": "Test multi-criteria endpoint (was broken before)",
        "command": "curl http://localhost:4002/multi-criteria",
        "expected": "Should load multi-criteria page without errors",
        "critical": false,
        "depends_on": "Step 6 - API Gateway must be running"
      },
      {
        "step": 8,
        "title": "Add Python ML services (optional, requires fixing submodule commits)",
        "command": "Update submodules with Dockerfile fixes, then docker-compose --profile gibd-quant up -d",
        "critical": false,
        "why": "These services provide AI features; not needed for basic functionality"
      }
    ],

    "issues_and_solutions": [
      {
        "issue": "Docker build fails with 'uv pip install --system -r pyproject.toml' returned non-zero code: 1",
        "root_cause": "Python Dockerfiles use -r flag (for requirements.txt) but with pyproject.toml",
        "solution": "Remove -r flag: change 'uv pip install --system -r pyproject.toml' to 'uv pip install --system'",
        "status": "FIXED in local Dockerfiles (5 files)",
        "affected_services": "gibd-quant-agent, gibd-quant-signal, gibd-quant-nlq, gibd-quant-calibration, gibd-quant-celery",
        "note": "These are git submodules; fixes were made locally but need separate commits in submodule repos"
      },
      {
        "issue": "Services not starting even after docker-compose up",
        "possible_causes": [
          ".env file missing on server",
          "Insufficient disk space",
          "Insufficient memory for Java services"
        ],
        "solution": "Create .env file, check disk space (df -h), check memory (free -h), view logs (docker-compose logs -f)",
        "status": "UNKNOWN - need to verify in next steps"
      },
      {
        "issue": "traefik not routing to gibd-quant-web",
        "possible_causes": [
          "gibd-quant-web container not running",
          "traefik not configured properly",
          "network connectivity issue"
        ],
        "solution": "Verify gibd-quant-web is running (docker-compose ps), check traefik config (docker-compose logs traefik), verify network (docker network ls)"
      },
      {
        "issue": "Coming Soon page not displaying for domain access",
        "possible_causes": [
          "middleware.ts not compiled into Docker image",
          "Old Docker image (v5) still running",
          "gibd-quant-web container not running"
        ],
        "solution": "Rebuild image: docker-compose build --no-cache gibd-quant-web, restart: docker-compose up -d gibd-quant-web"
      }
    ],

    "critical_paths": {
      "minimum_to_deploy": [
        "postgres - database",
        "redis - cache",
        "ws-discovery - Eureka service registry",
        "ws-gateway - API Gateway (routes all backend calls)",
        "gibd-quant-web - Frontend with Coming Soon middleware"
      ],
      "optional_but_recommended": [
        "ws-trades, ws-company, ws-news - data services",
        "gibd-quant-nlq, gibd-quant-signal - AI features"
      ],
      "deployment_order": "postgres → redis → ws-discovery (wait healthy) → ws-gateway (wait healthy) → other services → gibd-quant-web"
    },

    "performance_notes": {
      "first_build_time": "15-30 minutes (downloading Maven dependencies)",
      "subsequent_starts": "2-3 minutes",
      "disk_space_needed": "30GB minimum (Docker images ~15GB, data varies)",
      "memory_needed": "8GB minimum (Java services consume 500MB-1GB each)",
      "current_available": {
        "disk": "22GB in /home directory",
        "warning": "TIGHT - only 22GB available, need at least 30GB. May need to clean up /var (currently 50GB)"
      }
    },

    "testing_checklist": [
      {
        "test": "Coming Soon Feature",
        "command": "curl -H 'Host: www.guardianinvestmentbd.com' http://localhost/",
        "expected": "HTML page containing 'Coming Soon' and 'info@guardianinvestmentbd.com'",
        "critical": true
      },
      {
        "test": "Local IP Access (Full App)",
        "command": "curl http://localhost:3000/",
        "expected": "Full application home page, NO Coming Soon",
        "critical": true
      },
      {
        "test": "API Gateway Health",
        "command": "curl http://localhost:8080/actuator/health",
        "expected": "JSON response with 'status': 'UP'",
        "critical": true
      },
      {
        "test": "Eureka Service Registry",
        "command": "curl http://localhost:8761/actuator/health",
        "expected": "JSON response with 'status': 'UP'",
        "critical": true
      },
      {
        "test": "Multi-Criteria Endpoint",
        "command": "curl http://localhost:4002/multi-criteria",
        "expected": "Page loads without 500 errors",
        "critical": false
      },
      {
        "test": "Traefik Dashboard",
        "command": "curl http://localhost:8080/dashboard/",
        "expected": "HTML dashboard page",
        "critical": false
      }
    ],

    "git_commits_for_reference": [
      {
        "hash": "ed2f569",
        "message": "docs: Add complete deployment checklist for 10.0.0.84",
        "date": "2025-12-27"
      },
      {
        "hash": "00adaf7",
        "message": "docs: Add comprehensive environment configuration guide",
        "date": "2025-12-27"
      },
      {
        "hash": "fb2ebe7",
        "message": "docs: Add emergency service recovery guide",
        "date": "2025-12-27"
      },
      {
        "hash": "611c721",
        "message": "docs: Add Coming Soon deployment guide with instructions and troubleshooting",
        "date": "2025-12-27"
      },
      {
        "hash": "31b30a4",
        "message": "feat: Add Coming Soon page for guardianinvestmentbd.com domain",
        "date": "2025-12-27",
        "note": "Core feature implementation"
      },
      {
        "hash": "5662367",
        "message": "fix: Add master branch support to CI/CD pipeline",
        "date": "2025-12-27"
      },
      {
        "hash": "0aafcb3",
        "message": "fix: Fix detect-changes stage to work with alpine git image",
        "date": "2025-12-27"
      }
    ],

    "contact_information": {
      "feature_email": "info@guardianinvestmentbd.com",
      "server": "10.0.0.84",
      "ssh_user": "wizardsofts",
      "ssh_password": "29Dec2#24",
      "db_password": "29Dec2#24"
    },

    "known_limitations": [
      "Python ML services (signal, NLQ, calibration, agent) have Dockerfile syntax errors that need fixing in git submodules",
      "Google Analytics and AdSense IDs are placeholders - need real values from client",
      "OpenAI API key is placeholder - AI features disabled until real key provided",
      "Disk space is tight (only 22GB available, need 30GB) - may need cleanup"
    ],

    "recommendations_for_next_agent": [
      "Start with Step 1 (create .env) and Step 3 (start core services)",
      "Focus on Java services first, leave Python ML services for later",
      "Test Coming Soon feature works before doing anything else",
      "Monitor logs closely: 'docker-compose logs -f' to see what's happening",
      "Don't worry about Python service builds until core services are stable",
      "Contact user for real Google Analytics ID and OpenAI API key when available"
    ],

    "deployment_architecture_analysis": {
      "current_reality": {
        "traefik": "Standalone systemd process (NOT Docker) - PID 3083490",
        "wizardsofts_com": "Process-based Next.js on port 4000 (NOT Docker)",
        "daily_deen": "Unknown - likely process-based as well",
        "gibd_services": "NOT deployed - docker-compose.yml exists but containers not running",
        "mailcow": "NOT running - docker-compose ready but network missing",
        "appwrite": "Docker containers - RUNNING properly"
      },
      "code_vs_reality_mismatch": {
        "issue": "docker-compose.yml expects containerized deployment, but production runs processes",
        "severity": "MEDIUM - Working but inconsistent",
        "impact": [
          "Cannot use 'docker-compose up' to deploy websites (already running as processes)",
          "Documentation doesn't match deployment",
          "Network configuration confusion (microservices-overlay not needed for current setup)",
          "Difficult to replicate environment locally"
        ]
      },
      "network_architecture": {
        "current": "Direct localhost connections + Traefik standalone",
        "expected_by_code": "Docker networks (microservices-overlay, gibd-network, mailcow-network)",
        "resolution_needed": "Decide on unified approach"
      }
    },

    "recommended_deployment_plan": {
      "phase_1_immediate_mailcow": {
        "goal": "Get mailcow email running (quick win)",
        "steps": [
          {
            "action": "Create microservices-overlay network",
            "command": "docker network create microservices-overlay",
            "why": "Required by mailcow docker-compose.override.yml and Traefik docker-compose",
            "risk": "Low - just creates network"
          },
          {
            "action": "Start mailcow containers",
            "command": "cd /home/wizardsofts/mailcow-dockerized && docker-compose up -d",
            "why": "Email service for mail.wizardsofts.com and mail.dailydeenguide.com",
            "expected_time": "5-10 minutes",
            "risk": "Low - mailcow is well-tested"
          },
          {
            "action": "Verify mailcow accessible",
            "command": "curl -k https://mail.wizardsofts.com",
            "expected": "Mailcow login page",
            "risk": "None - just verification"
          }
        ],
        "outcome": "Email service operational, Traefik routing to mailcow working"
      },
      "phase_2_gibd_services_decision": {
        "goal": "Deploy GIBD services (guardianinvestmentbd.com Coming Soon feature)",
        "decision_required": "Choose deployment approach",
        "option_a_docker": {
          "approach": "Use docker-compose.yml as designed",
          "pros": [
            "Matches codebase design",
            "Easy to manage (docker-compose up/down)",
            "Isolated environments",
            "Scalable and portable",
            "Consistent with Appwrite deployment"
          ],
          "cons": [
            "Requires network configuration",
            "More resource usage (each container has overhead)",
            "Need to migrate existing process-based websites OR run parallel"
          ],
          "steps": [
            "Create .env with DB_PASSWORD=29Dec2#24",
            "Update .env placeholders",
            "docker-compose --profile gibd-quant up -d postgres redis ws-discovery ws-gateway gibd-quant-web",
            "Wait for health checks",
            "Test Coming Soon feature"
          ]
        },
        "option_b_process_based": {
          "approach": "Continue process-based deployment like current websites",
          "pros": [
            "Consistent with existing wizardsofts.com deployment",
            "Less resource overhead",
            "Simpler networking (localhost)"
          ],
          "cons": [
            "Manual process management",
            "Harder to replicate",
            "Diverges from codebase design",
            "No isolation between services"
          ],
          "steps": [
            "Build Java services manually",
            "Run Java services with systemd or supervisord",
            "Build and run gibd-quant-web Next.js app",
            "Configure Traefik dynamic config with localhost ports"
          ]
        },
        "recommendation": "OPTION A (Docker) - Better long-term, matches codebase, easier management"
      },
      "phase_3_architecture_alignment": {
        "goal": "Align all deployments to consistent architecture",
        "decision": "Migrate wizardsofts.com and daily-deen to Docker OR document process-based as standard",
        "recommended_approach": "Migrate to Docker for consistency",
        "migration_steps": [
          {
            "service": "wizardsofts.com",
            "action": "Deploy via docker-compose --profile web-apps",
            "preparation": [
              "Stop current Next.js processes (kill PIDs 10973, 3021704, 3021705, 3274187)",
              "Update Traefik dynamic config to use Docker service name",
              "Ensure Docker image is built"
            ],
            "command": "docker-compose --profile web-apps up -d ws-wizardsofts-web",
            "verify": "curl https://www.wizardsofts.com",
            "rollback_plan": "Restart process-based deployment if issues"
          },
          {
            "service": "dailydeen.com",
            "action": "Same as wizardsofts.com but for ws-daily-deen-web",
            "command": "docker-compose --profile web-apps up -d ws-daily-deen-web"
          }
        ]
      }
    },

    "execution_summary": {
      "priority_order": [
        "1. IMMEDIATE: Create microservices-overlay network (enables mailcow + future Docker deployments)",
        "2. QUICK WIN: Start mailcow (5-10 min, gets email working)",
        "3. CRITICAL: Deploy GIBD services via Docker (Coming Soon feature - original request)",
        "4. OPTIONAL: Migrate wizardsofts.com to Docker (alignment, can wait)"
      ],
      "estimated_timeline": {
        "phase_1_mailcow": "30 minutes (network + mailcow start + verify)",
        "phase_2_gibd_docker": "1-2 hours (env setup, build, deploy, test)",
        "phase_3_migration": "2-3 hours (careful migration of live sites)"
      },
      "critical_commands_sequence": [
        "docker network create microservices-overlay",
        "cd /home/wizardsofts/mailcow-dockerized && docker-compose up -d",
        "cd /home/wizardsofts/wizardsofts-megabuild && sed -i 's/your_postgres_password_here/29Dec2#24/' .env",
        "docker-compose --profile gibd-quant up -d postgres redis ws-discovery ws-gateway gibd-quant-web",
        "sleep 120 && docker-compose ps",
        "curl -H 'Host: www.guardianinvestmentbd.com' https://localhost/coming-soon"
      ]
    },

    "disk_space_management": {
      "investigation_date": "2025-12-28 14:00 UTC",
      "root_cause_identified": "✅ SOLVED - LVM logical volume only using 100GB of 928GB available disk space",
      "current_status": {
        "physical_disk": {
          "device": "nvme0n1",
          "size": "931.5GB (1TB NVMe SSD)",
          "encrypted": "YES (dm_crypt-0)",
          "encrypted_size": "928.4GB"
        },
        "lvm_configuration": {
          "volume_group": "ubuntu-vg",
          "vg_total_size": "928.44 GiB",
          "vg_allocated": "100 GiB",
          "vg_free": "828.44 GiB (⚠️ UNALLOCATED!)",
          "logical_volume": "ubuntu-lv",
          "lv_size": "100GB (only 10.8% of available space!)"
        },
        "filesystem": "/dev/mapper/ubuntu--vg-ubuntu--lv",
        "current_size": "98GB",
        "used": "77GB (83% full)",
        "available": "17GB",
        "critical_threshold": "90% (88GB)",
        "warning": "⚠️ Can easily expand to 928GB!"
      },
      "solution": {
        "approach": "EXPAND LVM LOGICAL VOLUME (NO CLEANUP NEEDED)",
        "benefit": "Gain 828GB additional space instantly (no data deletion required)",
        "risk": "LOW - Non-destructive operation",
        "downtime_required": "NONE - Can be done online while system is running"
      },
      "space_breakdown": {
        "duplicate_deployments": {
          "total": "21.3GB (SAFE TO REMOVE)",
          "items": [
            {
              "path": "/home/wizardsofts/opt/apps",
              "size": "14GB",
              "description": "Old deployment directory - duplicate of /opt/wizardsofts-megabuild",
              "safe_to_delete": true,
              "priority": "HIGH"
            },
            {
              "path": "/home/wizardsofts/wizardsofts-megabuild",
              "size": "7.3GB",
              "description": "Another deployment copy - duplicate of /opt/wizardsofts-megabuild",
              "safe_to_delete": true,
              "priority": "HIGH"
            }
          ]
        },
        "docker_waste": {
          "total": "4.2GB (SAFE TO CLEAN)",
          "items": [
            {
              "type": "Build cache",
              "size": "4.178GB",
              "command_to_clean": "docker builder prune -af",
              "description": "Unused build cache from failed builds",
              "safe_to_delete": true,
              "priority": "HIGH"
            },
            {
              "type": "Exited containers",
              "size": "~50MB",
              "containers": [
                "runner-ni8j8cgkf-project-31-concurrent-0-a1ccc27130a0fc02-build",
                "runner-ni8j8cgkf-project-31-concurrent-0-a1ccc27130a0fc02-docker-0",
                "elegant_pare",
                "sleepy_hopper"
              ],
              "command_to_clean": "docker container prune -f",
              "safe_to_delete": true,
              "priority": "MEDIUM"
            }
          ]
        },
        "old_projects": {
          "total": "~500MB (VERIFY BEFORE REMOVING)",
          "items": [
            {
              "path": "/home/wizardsofts/gibd-web-scraper",
              "size": "375MB",
              "description": "Older version - duplicate exists in /opt/wizardsofts-megabuild/apps",
              "safe_to_delete": "likely",
              "priority": "MEDIUM",
              "verify_first": true
            },
            {
              "path": "/home/wizardsofts/autoscaler_deploy",
              "size": "111MB",
              "description": "Old autoscaler deployment files",
              "safe_to_delete": "likely",
              "priority": "LOW",
              "verify_first": true
            }
          ]
        },
        "active_deployment": {
          "total": "7.3GB (KEEP)",
          "path": "/opt/wizardsofts-megabuild",
          "breakdown": [
            {
              "app": "gibd-web-scraper",
              "size": "2.3GB",
              "components": {
                "vector_index": "904MB",
                "vector_index_clean": "888MB",
                "scraper_db": "57MB",
                "note": "Vector indices can be regenerated if needed"
              }
            },
            {
              "app": "gibd-rl-trader",
              "size": "2.0GB",
              "note": "Contains Python .venv (virtual environment)"
            },
            {
              "app": "gibd-quant-agent",
              "size": "1.3GB",
              "note": "Contains Python .venv (virtual environment)"
            },
            {
              "app": "gibd-vector-context",
              "size": "678MB"
            },
            {
              "app": "gibd-quant-web",
              "size": "391MB"
            },
            {
              "app": "ws-daily-deen-web",
              "size": "359MB"
            },
            {
              "app": "gibd-intelligence",
              "size": "281MB"
            },
            {
              "app": "ws-wizardsofts-web",
              "size": "167MB"
            }
          ]
        },
        "docker_images": {
          "total": "~2.5GB (KEEP - IN USE)",
          "images": [
            {"name": "appwrite/appwrite:1.8.1", "size": "1.33GB", "status": "running"},
            {"name": "docker:24-dind", "size": "350MB", "status": "gitlab-runner"},
            {"name": "mariadb:10.11", "size": "331MB", "status": "running"},
            {"name": "docker:24-cli", "size": "180MB", "status": "gitlab-runner"},
            {"name": "gitlab-runner-helper", "size": "107MB", "status": "gitlab-runner"},
            {"name": "redis:7-alpine", "size": "41MB", "status": "running"}
          ]
        },
        "system_files": {
          "swap": {
            "path": "/swap.img",
            "size": "8.1GB",
            "description": "System swap file - DO NOT DELETE",
            "safe_to_delete": false
          },
          "logs": {
            "path": "/var/log",
            "size": "~350MB",
            "largest": [
              {"file": "/var/log/journal", "size": "294MB"},
              {"file": "/var/log/syslog", "size": "21MB"},
              {"file": "/var/log/sysstat", "size": "19MB"},
              {"file": "/var/log/kern.log", "size": "8.4MB"}
            ],
            "cleanup_command": "sudo journalctl --vacuum-time=7d",
            "safe_to_clean": true,
            "priority": "LOW"
          }
        }
      },
      "disk_expansion_plan": {
        "primary_solution": "EXPAND LOGICAL VOLUME TO USE FREE SPACE",
        "space_gain": "828.44 GB",
        "post_expansion_status": {
          "projected_total": "928GB",
          "projected_used": "77GB",
          "projected_available": "851GB",
          "projected_usage_percent": "8%"
        },
        "expansion_options": {
          "option_1_expand_all": {
            "description": "Expand to use ALL available space (828GB)",
            "command_sequence": [
              "# 1. Extend logical volume to use all free space",
              "ssh wizardsofts@10.0.0.84 \"echo '29Dec2#24' | sudo -S lvextend -l +100%FREE /dev/ubuntu-vg/ubuntu-lv\"",
              "# 2. Resize filesystem to match new LV size",
              "ssh wizardsofts@10.0.0.84 \"echo '29Dec2#24' | sudo -S resize2fs /dev/ubuntu-vg/ubuntu-lv\"",
              "# 3. Verify new size",
              "ssh wizardsofts@10.0.0.84 'df -h /'"
            ],
            "result": "Root filesystem will be ~928GB (from 98GB)",
            "recommended": true,
            "risk": "LOW - Standard operation"
          },
          "option_2_expand_partial": {
            "description": "Expand by specific amount (e.g., +400GB)",
            "command_sequence": [
              "# 1. Extend logical volume by 400GB",
              "ssh wizardsofts@10.0.0.84 \"echo '29Dec2#24' | sudo -S lvextend -L +400G /dev/ubuntu-vg/ubuntu-lv\"",
              "# 2. Resize filesystem",
              "ssh wizardsofts@10.0.0.84 \"echo '29Dec2#24' | sudo -S resize2fs /dev/ubuntu-vg/ubuntu-lv\"",
              "# 3. Verify new size",
              "ssh wizardsofts@10.0.0.84 'df -h /'"
            ],
            "result": "Root filesystem will be ~498GB (from 98GB)",
            "recommended": false,
            "note": "Use if you want to reserve space for other purposes"
          }
        },
        "execution_steps": {
          "step_1_verify_current_state": {
            "description": "Confirm current LVM configuration",
            "commands": [
              "ssh wizardsofts@10.0.0.84 \"echo '29Dec2#24' | sudo -S vgdisplay ubuntu-vg | grep 'Free'\"",
              "ssh wizardsofts@10.0.0.84 'df -h /'"
            ],
            "expected_output": "Free PE: 212081 (828.44 GiB), / = 98G"
          },
          "step_2_extend_lv": {
            "description": "Extend the logical volume",
            "command": "ssh wizardsofts@10.0.0.84 \"echo '29Dec2#24' | sudo -S lvextend -l +100%FREE /dev/ubuntu-vg/ubuntu-lv\"",
            "expected_output": "Size of logical volume ubuntu-vg/ubuntu-lv changed from 100.00 GiB to 928.44 GiB",
            "duration": "< 1 second",
            "risk": "LOW"
          },
          "step_3_resize_filesystem": {
            "description": "Resize the ext4 filesystem to use new space",
            "command": "ssh wizardsofts@10.0.0.84 \"echo '29Dec2#24' | sudo -S resize2fs /dev/ubuntu-vg/ubuntu-lv\"",
            "expected_output": "The filesystem on /dev/ubuntu-vg/ubuntu-lv is now 243380224 blocks long",
            "duration": "5-30 seconds",
            "risk": "LOW",
            "note": "Can be done online while system is running"
          },
          "step_4_verify_expansion": {
            "description": "Verify the filesystem is expanded",
            "command": "ssh wizardsofts@10.0.0.84 'df -h /'",
            "expected_output": "Size: ~912G, Used: 77G, Avail: ~835G, Use%: 9%",
            "critical": true
          }
        },
        "safety_notes": [
          "✅ Non-destructive operation - no data loss risk",
          "✅ Can be done online - no downtime required",
          "✅ Filesystem will remain accessible during resize",
          "✅ Standard LVM operation - used millions of times daily",
          "⚠️ Always verify free space BEFORE extending: vgdisplay",
          "⚠️ Ensure filesystem type is ext4 (confirmed: ubuntu-lv uses ext4)"
        ],
        "rollback_plan": {
          "description": "In extremely unlikely case of issues",
          "note": "lvextend and resize2fs are non-destructive - rollback not typically needed",
          "emergency_steps": [
            "1. Boot from rescue media if filesystem becomes inaccessible",
            "2. Run fsck: e2fsck -f /dev/ubuntu-vg/ubuntu-lv",
            "3. Resize filesystem back: resize2fs /dev/ubuntu-vg/ubuntu-lv 100G",
            "4. Reduce LV: lvreduce -L 100G /dev/ubuntu-vg/ubuntu-lv"
          ],
          "probability": "< 0.01% (extremely rare)"
        }
      },
      "optional_cleanup_after_expansion": {
        "note": "After expanding to 928GB, cleanup becomes optional (not urgent)",
        "items": [
          {
            "action": "Remove duplicate deployments",
            "paths": ["/home/wizardsofts/opt (14GB)", "/home/wizardsofts/wizardsofts-megabuild (7.3GB)"],
            "space_freed": "21.3GB",
            "priority": "LOW (can do later)"
          },
          {
            "action": "Clean Docker build cache",
            "command": "docker builder prune -af",
            "space_freed": "4.2GB",
            "priority": "MEDIUM (good practice)"
          },
          {
            "action": "Remove old projects",
            "paths": ["/home/wizardsofts/gibd-web-scraper (375MB)", "/home/wizardsofts/autoscaler_deploy (111MB)"],
            "space_freed": "~500MB",
            "priority": "LOW"
          }
        ]
      },
      "monitoring_plan": {
        "add_to_cicd_pipeline": {
          "stage": "post-deploy",
          "job_name": "disk-space-check",
          "script": [
            "# Check disk space after deployment",
            "DISK_USAGE=$(ssh $DEPLOY_USER@$DEPLOY_HOST \"df -h / | awk 'NR==2 {print \\$5}' | sed 's/%//'\")",
            "echo \"Current disk usage: ${DISK_USAGE}%\"",
            "# Alert if above 85%",
            "if [ $DISK_USAGE -gt 85 ]; then",
            "  echo \"⚠️ WARNING: Disk usage above 85%\"",
            "  echo \"Running cleanup...\"",
            "  ssh $DEPLOY_USER@$DEPLOY_HOST 'docker builder prune -f'",
            "  ssh $DEPLOY_USER@$DEPLOY_HOST 'docker container prune -f'",
            "  ssh $DEPLOY_USER@$DEPLOY_HOST 'docker image prune -f'",
            "fi",
            "# Fail if above 90%",
            "if [ $DISK_USAGE -gt 90 ]; then",
            "  echo \"❌ ERROR: Disk usage above 90% - deployment may fail\"",
            "  exit 1",
            "fi"
          ]
        },
        "cron_job": {
          "schedule": "0 2 * * 0",
          "description": "Weekly cleanup at 2 AM Sunday",
          "command": "docker builder prune -f && docker container prune -f && docker image prune -a -f --filter 'until=168h'",
          "install_on_server": "echo '0 2 * * 0 docker builder prune -f && docker container prune -f' | crontab -"
        },
        "alerting": {
          "threshold_warning": "85%",
          "threshold_critical": "90%",
          "notification_method": "GitLab CI/CD pipeline notification",
          "action_on_critical": "Auto-cleanup Docker cache and fail deployment"
        }
      },
      "disk_usage_best_practices": {
        "recommendations": [
          "Keep only one deployment directory (/opt/wizardsofts-megabuild)",
          "Remove old deployment copies from /home/wizardsofts",
          "Run 'docker builder prune' after each deployment",
          "Implement log rotation (journald already does this, but verify)",
          "Monitor disk usage in CI/CD pipeline",
          "Set up alerts at 85% disk usage",
          "Consider increasing disk size if growth continues (current 98GB may be insufficient)"
        ],
        "future_considerations": [
          "If apps continue growing, may need 150-200GB disk",
          "Vector indices (1.8GB in gibd-web-scraper) can be regenerated if needed",
          "Python .venv directories (large) should not be in deployment - use Docker multi-stage builds",
          "Consider using Docker volumes for data (separates from root filesystem)"
        ]
      }
    },

    "cicd_deployment_approach": {
      "decision": "USE CI/CD PIPELINE (RECOMMENDED)",
      "rationale": [
        "GitLab Runner already running on server (verified)",
        ".gitlab-ci.yml already configured with deployment stages",
        "Automated, repeatable, version-controlled",
        "Built-in health checks and rollback",
        "Zero human error in deployment",
        "Consistent across all environments"
      ],
      "current_pipeline_status": {
        "file": ".gitlab-ci.yml",
        "stages": ["detect", "test", "build", "deploy"],
        "configured_for": "10.0.0.84 deployment",
        "profiles_supported": ["gibd-quant", "web-apps", "all"],
        "runner_on_server": "✅ runner-ni8j8cgkf-project-31-concurrent-0 (active)",
        "last_verified": "2025-12-28"
      },
      "required_updates_to_pipeline": {
        "priority_1_fix_process_cleanup": {
          "issue": "Pipeline doesn't stop existing Next.js processes before deploying Docker containers",
          "location": ".gitlab-ci.yml deploy-to-84 stage",
          "add_before_docker_up": [
            "# Stop existing Next.js processes",
            "pkill -f 'next-server' || true",
            "# Verify processes stopped",
            "sleep 2",
            "pgrep -f 'next-server' || echo 'All Next.js processes stopped'"
          ],
          "risk": "Medium - processes may conflict with Docker containers on same ports"
        },
        "priority_2_network_creation": {
          "issue": "Pipeline doesn't create microservices-overlay network",
          "location": ".gitlab-ci.yml deploy-to-84 stage",
          "add_before_docker_up": [
            "# Create microservices-overlay network if not exists",
            "docker network create microservices-overlay 2>/dev/null || echo 'Network already exists'",
            "# Verify network exists",
            "docker network ls | grep microservices-overlay"
          ],
          "risk": "Low - idempotent network creation"
        },
        "priority_3_env_validation": {
          "issue": "Pipeline uses .env.example which has placeholders",
          "location": ".gitlab-ci.yml deploy-to-84 stage line 268",
          "current_code": "if [ ! -f \".env\" ]; then cp .env.example .env; fi",
          "recommended_change": "Use GitLab CI/CD variables or secret management",
          "add_validation": [
            "# Validate .env has real values, not placeholders",
            "if grep -q 'your_postgres_password_here' .env; then",
            "  echo 'ERROR: .env contains placeholder values!'",
            "  exit 1",
            "fi"
          ],
          "risk": "High - services won't start with placeholder values"
        },
        "priority_4_mailcow_integration": {
          "issue": "Pipeline doesn't deploy mailcow",
          "add_new_job": "deploy-mailcow",
          "stage": "deploy",
          "dependencies": ["deploy-to-84"],
          "script": [
            "ssh $DEPLOY_USER@$DEPLOY_HOST 'cd /home/wizardsofts/mailcow-dockerized && docker-compose up -d'",
            "# Wait for mailcow to start",
            "sleep 30",
            "# Verify mailcow is up",
            "ssh $DEPLOY_USER@$DEPLOY_HOST 'docker-compose -f /home/wizardsofts/mailcow-dockerized/docker-compose.yml ps'"
          ]
        },
        "priority_5_traefik_config_update": {
          "issue": "Traefik dynamic config needs updating for Docker container names",
          "location": "/home/wizardsofts/traefik/dynamic_conf.yml on server",
          "required_changes": [
            {
              "service": "wizardsofts-web",
              "current_backend": "http://ws-wizardsofts-web:3000",
              "issue": "Container name resolution only works if on same Docker network",
              "fix": "Ensure Traefik process can resolve Docker container names OR use localhost:4000"
            },
            {
              "mail_domains": ["mail.mypadmafoods.com", "mail.guardianinvestmentbd.com"],
              "current_config": "Only has mail.wizardsofts.com and mail.dailydeenguide.com",
              "add_to_tcp_router": "Update mailcow-ui router HostSNI to include new domains"
            }
          ]
        }
      },
      "deployment_workflow": {
        "step_1_prepare_server": {
          "description": "One-time server preparation before CI/CD deployment",
          "tasks": [
            {
              "action": "Stop existing Next.js processes manually",
              "command": "ssh wizardsofts@10.0.0.84 'pkill -f next-server'",
              "why": "Prevents port conflicts before first CI/CD deployment",
              "one_time": true
            },
            {
              "action": "Create microservices-overlay network",
              "command": "ssh wizardsofts@10.0.0.84 'docker network create microservices-overlay'",
              "why": "Required by mailcow and web services",
              "one_time": true
            },
            {
              "action": "Create proper .env file",
              "command": "ssh wizardsofts@10.0.0.84 'cd /home/wizardsofts/wizardsofts-megabuild && sed -i \"s/your_postgres_password_here/29Dec2#24/\" .env'",
              "why": "Replace placeholders with real values",
              "one_time": true
            },
            {
              "action": "Update mailcow docker-compose.override.yml",
              "file": "/home/wizardsofts/mailcow-dockerized/docker-compose.override.yml",
              "add_domains": ["mail.mypadmafoods.com", "mail.guardianinvestmentbd.com"],
              "one_time": true
            }
          ]
        },
        "step_2_trigger_deployment": {
          "description": "Deploy via GitLab CI/CD pipeline",
          "method_1_git_push": {
            "approach": "Push code changes to trigger pipeline",
            "commands": [
              "git add .",
              "git commit -m 'feat: Deploy all services via Docker containers'",
              "git push origin master"
            ],
            "result": "Pipeline automatically builds and deploys",
            "timeline": "10-15 minutes (build + deploy + health checks)"
          },
          "method_2_manual_trigger": {
            "approach": "Trigger pipeline manually from GitLab UI",
            "steps": [
              "Navigate to GitLab project → CI/CD → Pipelines",
              "Click 'Run Pipeline'",
              "Select branch: master",
              "Click 'Run Pipeline'"
            ],
            "result": "Same as git push, but doesn't require code change"
          }
        },
        "step_3_verify_deployment": {
          "description": "Verify all services deployed successfully",
          "checks": [
            {
              "service": "wizardsofts.com",
              "test": "curl https://www.wizardsofts.com",
              "expected": "HTTP 200, WizardSofts homepage"
            },
            {
              "service": "GIBD Coming Soon",
              "test": "curl -H 'Host: www.guardianinvestmentbd.com' https://10.0.0.84/coming-soon",
              "expected": "Coming Soon page with info@guardianinvestmentbd.com"
            },
            {
              "service": "Mailcow",
              "test": "curl -k https://mail.wizardsofts.com",
              "expected": "Mailcow login page"
            },
            {
              "service": "Docker containers",
              "test": "ssh wizardsofts@10.0.0.84 'docker ps'",
              "expected": "ws-wizardsofts-web, gibd-quant-web, postgres, redis, ws-discovery, ws-gateway running"
            }
          ]
        },
        "step_4_rollback_if_needed": {
          "description": "Rollback procedure if deployment fails",
          "manual_rollback": [
            "ssh wizardsofts@10.0.0.84 'cd /home/wizardsofts/wizardsofts-megabuild && docker-compose down'",
            "Restart old Next.js processes if needed",
            "Check GitLab pipeline logs for errors",
            "Fix issues and re-trigger pipeline"
          ],
          "automated_rollback": "Pipeline can be extended with automatic rollback on health check failure"
        }
      },
      "immediate_action_plan": {
        "phase_1_server_prep": [
          "1. SSH to server: ssh wizardsofts@10.0.0.84",
          "2. Stop processes: pkill -f next-server",
          "3. Create network: docker network create microservices-overlay",
          "4. Fix .env: sed -i 's/your_postgres_password_here/29Dec2#24/' /home/wizardsofts/wizardsofts-megabuild/.env",
          "5. Update mailcow override with new mail domains"
        ],
        "phase_2_update_pipeline": [
          "1. Edit .gitlab-ci.yml to add process cleanup and network creation",
          "2. Commit and push changes",
          "3. Pipeline auto-triggers and deploys"
        ],
        "phase_3_manual_mailcow": [
          "1. After pipeline completes, manually start mailcow",
          "2. ssh wizardsofts@10.0.0.84 'cd /home/wizardsofts/mailcow-dockerized && docker-compose up -d'",
          "3. Verify: curl -k https://mail.wizardsofts.com"
        ]
      },
      "benefits_vs_manual": {
        "ci_cd": {
          "consistency": "Same steps every deployment",
          "rollback": "Git revert + re-deploy",
          "audit_trail": "All deployments logged in GitLab",
          "zero_human_error": "Automated execution",
          "health_checks": "Built into pipeline",
          "time": "10-15 min automated"
        },
        "manual": {
          "consistency": "Depends on human following steps",
          "rollback": "Manual reverse steps",
          "audit_trail": "None unless documented",
          "human_error": "High risk",
          "health_checks": "Manual",
          "time": "30-60 min manual work"
        },
        "verdict": "CI/CD is superior in every way"
      }
    }
  }
}
